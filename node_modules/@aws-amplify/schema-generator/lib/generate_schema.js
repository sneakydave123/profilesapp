import { TypescriptDataSchemaGenerator } from '@aws-amplify/graphql-schema-generator';
import fs from 'fs/promises';
import { AmplifyUserError } from '@aws-amplify/platform-core';
/**
 * Schema generator class.
 */
export class SchemaGenerator {
    generate = async (props) => {
        const dbConfig = parseDatabaseUrl(props.connectionUri.value);
        try {
            const schema = await TypescriptDataSchemaGenerator.generate({
                ...dbConfig,
                connectionUriSecretName: props.connectionUri.secretName,
                ...(props.sslCert &&
                    props.sslCert.secretName && {
                    sslCertificateSecretName: props.sslCert.secretName,
                    sslCertificate: props.sslCert.value,
                }),
            });
            await fs.writeFile(props.out, schema);
        }
        catch (err) {
            const databaseError = err;
            if (databaseError.code === 'ETIMEDOUT') {
                throw new AmplifyUserError('DatabaseConnectionError', {
                    message: `Unable to connect to the database at ${dbConfig.host}:${dbConfig.port}. `,
                    resolution: 'Check if the credentials are correct. Also, check if the database is running and accessible from the network.',
                }, databaseError);
            }
            throw err;
        }
    };
}
const DEFAULT_ENGINE = 'mysql';
/**
 * Error for database connection failures.
 * This class is intended to be used for casting database connection errors.
 * Do not create instances of this class directly.
 */
class DatabaseConnectError extends Error {
    code;
    /**
     * Creates database connection error.
     */
    constructor(code) {
        super(`Database connection error: ${code}`);
        this.code = code;
    }
}
/**
 * Parses database URL into a configuration object.
 */
export const parseDatabaseUrl = (databaseUrl) => {
    try {
        const parsedDatabaseUrl = new URL(databaseUrl);
        const { username: encodedUsername, password: encodedPassword, hostname: encodedHost, } = parsedDatabaseUrl;
        const username = decodeURIComponent(encodedUsername);
        const password = decodeURIComponent(encodedPassword);
        const host = decodeURIComponent(encodedHost);
        const database = decodeURIComponent(parsedDatabaseUrl?.pathname?.slice(1));
        // Default engine is MySQL
        const engine = constructDBEngine(parsedDatabaseUrl?.protocol?.slice(0, -1) ?? DEFAULT_ENGINE);
        const port = parsedDatabaseUrl?.port
            ? parseInt(parsedDatabaseUrl?.port, 10)
            : getDefaultPort(engine);
        const config = {
            engine,
            username,
            password,
            database,
            host,
            port,
        };
        const missingParts = Object.keys(config).filter((part) => !config[part]);
        if (missingParts.length > 0) {
            throw new AmplifyUserError('DatabaseUrlParseError', {
                message: `One or more parts of the database URL is missing. Missing [${missingParts.join(', ')}].`,
                resolution: 'Ensure the database URL follows the pattern "[mysql|postgresql]://username:password@hostname:port/database".',
            });
        }
        return config;
    }
    catch (err) {
        const error = err;
        throw new AmplifyUserError('DatabaseUrlParseError', {
            message: `Unable to parse the database URL. ${error.message}`,
            resolution: 'Check if the database URL is correct and accessible.',
        });
    }
};
const constructDBEngine = (engine) => {
    switch (engine) {
        case 'mysql':
            return 'mysql';
        case 'postgresql':
        case 'postgres':
            return 'postgresql';
        default:
            throw new Error(`Unsupported database engine: ${engine}`);
    }
};
const getDefaultPort = (engine) => {
    switch (engine) {
        case 'mysql':
            return 3306;
        case 'postgresql':
            return 5432;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVfc2NoZW1hLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2dlbmVyYXRlX3NjaGVtYS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUN0RixPQUFPLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDN0IsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFrQjlEOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGVBQWU7SUFDMUIsUUFBUSxHQUFHLEtBQUssRUFBRSxLQUE0QixFQUFFLEVBQUU7UUFDaEQsTUFBTSxRQUFRLEdBQUcsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUU3RCxJQUFJO1lBQ0YsTUFBTSxNQUFNLEdBQUcsTUFBTSw2QkFBNkIsQ0FBQyxRQUFRLENBQUM7Z0JBQzFELEdBQUcsUUFBUTtnQkFDWCx1QkFBdUIsRUFBRSxLQUFLLENBQUMsYUFBYSxDQUFDLFVBQVU7Z0JBQ3ZELEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTztvQkFDZixLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsSUFBSTtvQkFDMUIsd0JBQXdCLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVO29CQUNsRCxjQUFjLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLO2lCQUNwQyxDQUFDO2FBQ0wsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDdkM7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNaLE1BQU0sYUFBYSxHQUFHLEdBQTJCLENBQUM7WUFDbEQsSUFBSSxhQUFhLENBQUMsSUFBSSxLQUFLLFdBQVcsRUFBRTtnQkFDdEMsTUFBTSxJQUFJLGdCQUFnQixDQUN4Qix5QkFBeUIsRUFDekI7b0JBQ0UsT0FBTyxF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QUNsQixLQUFLLFVBQVU7WUFDYixPQUFPLFlBQVksQ0FBQztRQUN0QjtZQUNFLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLE1BQU0sRUFBRSxDQUFDLENBQUM7S0FDN0Q7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLGNBQWMsR0FBRyxDQUFDLE1BQWlCLEVBQVUsRUFBRTtJQUNuRCxRQUFRLE1BQU0sRUFBRTtRQUNkLEtBQUssT0FBTztZQUNWLE9BQU8sSUFBSSxDQUFDO1FBQ2QsS0FBSyxZQUFZO1lBQ2YsT0FBTyxJQUFJLENBQUM7S0FDZjtBQUNILENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFR5cGVzY3JpcHREYXRhU2NoZW1hR2VuZXJhdG9yIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L2dyYXBocWwtc2NoZW1hLWdlbmVyYXRvcic7XG5pbXBvcnQgZnMgZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0IHsgQW1wbGlmeVVzZXJFcnJvciB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbGF0Zm9ybS1jb3JlJztcblxuZXhwb3J0IHR5cGUgU2NoZW1hR2VuZXJhdG9yQ29uZmlnID0ge1xuICBjb25uZWN0aW9uVXJpOiB7XG4gICAgc2VjcmV0TmFtZTogc3RyaW5nO1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gIH07XG4gIHNzbENlcnQ/OiB7XG4gICAgc2VjcmV0TmFtZTogc3RyaW5nO1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gIH07XG4gIG91dDogc3RyaW5nO1xufTtcblxudHlwZSBBbXBsaWZ5R2VuZXJhdGVTY2hlbWFFcnJvciA9XG4gIHwgJ0RhdGFiYXNlQ29ubmVjdGlvbkVycm9yJ1xuICB8ICdEYXRhYmFzZVVybFBhcnNlRXJyb3InO1xuXG4vKipcbiAqIFNjaGVtYSBnZW5lcmF0b3IgY2xhc3MuXG4gKi9cbmV4cG9ydCBjbGFzcyBTY2hlbWFHZW5lcmF0b3Ige1xuICBnZW5lcmF0ZSA9IGFzeW5jIChwcm9wczogU2NoZW1hR2VuZXJhdG9yQ29uZmlnKSA9PiB7XG4gICAgY29uc3QgZGJDb25maWcgPSBwYXJzZURhdGFiYXNlVXJsKHByb3BzLmNvbm5lY3Rpb25VcmkudmFsdWUpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNjaGVtYSA9IGF3YWl0IFR5cGVzY3JpcHREYXRhU2NoZW1hR2VuZXJhdG9yLmdlbmVyYXRlKHtcbiAgICAgICAgLi4uZGJDb25maWcsXG4gICAgICAgIGNvbm5lY3Rpb25VcmlTZWNyZXROYW1lOiBwcm9wcy5jb25uZWN0aW9uVXJpLnNlY3JldE5hbWUsXG4gICAgICAgIC4uLihwcm9wcy5zc2xDZXJ0ICYmXG4gICAgICAgICAgcHJvcHMuc3NsQ2VydC5zZWNyZXROYW1lICYmIHtcbiAgICAgICAgICAgIHNzbENlcnRpZmljYXRlU2VjcmV0TmFtZTogcHJvcHMuc3NsQ2VydC5zZWNyZXROYW1lLFxuICAgICAgICAgICAgc3NsQ2VydGlmaWNhdGU6IHByb3BzLnNzbENlcnQudmFsdWUsXG4gICAgICAgICAgfSksXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShwcm9wcy5vdXQsIHNjaGVtYSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zdCBkYXRhYmFzZUVycm9yID0gZXJyIGFzIERhdGFiYXNlQ29ubmVjdEVycm9yO1xuICAgICAgaWYgKGRhdGFiYXNlRXJyb3IuY29kZSA9PT0gJ0VUSU1FRE9VVCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFtcGxpZnlVc2VyRXJyb3I8QW1wbGlmeUdlbmVyYXRlU2NoZW1hRXJyb3I+KFxuICAgICAgICAgICdEYXRhYmFzZUNvbm5lY3Rpb25FcnJvcicsXG4gICAgICAgICAge1xuICAgICAgICAgICAgbWVzc2FnZTogYFVuYWJsZSB0byBjb25uZWN0IHRvIHRoZSBkYXRhYmFzZSBhdCAke2RiQ29uZmlnLmhvc3R9OiR7ZGJDb25maWcucG9ydH0uIGAsXG4gICAgICAgICAgICByZXNvbHV0aW9uOlxuICAgICAgICAgICAgICAnQ2hlY2sgaWYgdGhlIGNyZWRlbnRpYWxzIGFyZSBjb3JyZWN0LiBBbHNvLCBjaGVjayBpZiB0aGUgZGF0YWJhc2UgaXMgcnVubmluZyBhbmQgYWNjZXNzaWJsZSBmcm9tIHRoZSBuZXR3b3JrLicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBkYXRhYmFzZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgdHlwZSBTUUxFbmdpbmUgPSAnbXlzcWwnIHwgJ3Bvc3RncmVzcWwnO1xuY29uc3QgREVGQVVMVF9FTkdJTkUgPSAnbXlzcWwnO1xuXG5leHBvcnQgdHlwZSBTUUxEYXRhU291cmNlQ29uZmlnID0ge1xuICBlbmdpbmU6IFNRTEVuZ2luZTtcbiAgdXNlcm5hbWU6IHN0cmluZztcbiAgcGFzc3dvcmQ6IHN0cmluZztcbiAgaG9zdDogc3RyaW5nO1xuICBkYXRhYmFzZTogc3RyaW5nO1xuICBwb3J0OiBudW1iZXI7XG59O1xuXG4vKipcbiAqIEVycm9yIGZvciBkYXRhYmFzZSBjb25uZWN0aW9uIGZhaWx1cmVzLlxuICogVGhpcyBjbGFzcyBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGZvciBjYXN0aW5nIGRhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3JzLlxuICogRG8gbm90IGNyZWF0ZSBpbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBkaXJlY3RseS5cbiAqL1xuYWJzdHJhY3QgY2xhc3MgRGF0YWJhc2VDb25uZWN0RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGRhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3IuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihyZWFkb25seSBjb2RlPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoYERhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3I6ICR7Y29kZX1gKTtcbiAgfVxufVxuXG4vKipcbiAqIFBhcnNlcyBkYXRhYmFzZSBVUkwgaW50byBhIGNvbmZpZ3VyYXRpb24gb2JqZWN0LlxuICovXG5leHBvcnQgY29uc3QgcGFyc2VEYXRhYmFzZVVybCA9IChkYXRhYmFzZVVybDogc3RyaW5nKTogU1FMRGF0YVNvdXJjZUNvbmZpZyA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGFyc2VkRGF0YWJhc2VVcmwgPSBuZXcgVVJMKGRhdGFiYXNlVXJsKTtcbiAgICBjb25zdCB7XG4gICAgICB1c2VybmFtZTogZW5jb2RlZFVzZXJuYW1lLFxuICAgICAgcGFzc3dvcmQ6IGVuY29kZWRQYXNzd29yZCxcbiAgICAgIGhvc3RuYW1lOiBlbmNvZGVkSG9zdCxcbiAgICB9ID0gcGFyc2VkRGF0YWJhc2VVcmw7XG4gICAgY29uc3QgdXNlcm5hbWUgPSBkZWNvZGVVUklDb21wb25lbnQoZW5jb2RlZFVzZXJuYW1lKTtcbiAgICBjb25zdCBwYXNzd29yZCA9IGRlY29kZVVSSUNvbXBvbmVudChlbmNvZGVkUGFzc3dvcmQpO1xuICAgIGNvbnN0IGhvc3QgPSBkZWNvZGVVUklDb21wb25lbnQoZW5jb2RlZEhvc3QpO1xuICAgIGNvbnN0IGRhdGFiYXNlID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnNlZERhdGFiYXNlVXJsPy5wYXRobmFtZT8uc2xpY2UoMSkpO1xuICAgIC8vIERlZmF1bHQgZW5naW5lIGlzIE15U1FMXG4gICAgY29uc3QgZW5naW5lID0gY29uc3RydWN0REJFbmdpbmUoXG4gICAgICBwYXJzZWREYXRhYmFzZVVybD8ucHJvdG9jb2w/LnNsaWNlKDAsIC0xKSA/PyBERUZBVUxUX0VOR0lORVxuICAgICk7XG4gICAgY29uc3QgcG9ydCA9IHBhcnNlZERhdGFiYXNlVXJsPy5wb3J0XG4gICAgICA/IHBhcnNlSW50KHBhcnNlZERhdGFiYXNlVXJsPy5wb3J0LCAxMClcbiAgICAgIDogZ2V0RGVmYXVsdFBvcnQoZW5naW5lKTtcblxuICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgIGVuZ2luZSxcbiAgICAgIHVzZXJuYW1lLFxuICAgICAgcGFzc3dvcmQsXG4gICAgICBkYXRhYmFzZSxcbiAgICAgIGhvc3QsXG4gICAgICBwb3J0LFxuICAgIH0gYXMgU1FMRGF0YVNvdXJjZUNvbmZpZztcblxuICAgIGNvbnN0IG1pc3NpbmdQYXJ0cyA9IChcbiAgICAgIE9iamVjdC5rZXlzKGNvbmZpZykgYXMgQXJyYXk8a2V5b2YgU1FMRGF0YVNvdXJjZUNvbmZpZz5cbiAgICApLmZpbHRlcigocGFydCkgPT4gIWNvbmZpZ1twYXJ0XSk7XG5cbiAgICBpZiAobWlzc2luZ1BhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yPEFtcGxpZnlHZW5lcmF0ZVNjaGVtYUVycm9yPihcbiAgICAgICAgJ0RhdGFiYXNlVXJsUGFyc2VFcnJvcicsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXNzYWdlOiBgT25lIG9yIG1vcmUgcGFydHMgb2YgdGhlIGRhdGFiYXNlIFVSTCBpcyBtaXNzaW5nLiBNaXNzaW5nIFske21pc3NpbmdQYXJ0cy5qb2luKFxuICAgICAgICAgICAgJywgJ1xuICAgICAgICAgICl9XS5gLFxuICAgICAgICAgIHJlc29sdXRpb246XG4gICAgICAgICAgICAnRW5zdXJlIHRoZSBkYXRhYmFzZSBVUkwgZm9sbG93cyB0aGUgcGF0dGVybiBcIltteXNxbHxwb3N0Z3Jlc3FsXTovL3VzZXJuYW1lOnBhc3N3b3JkQGhvc3RuYW1lOnBvcnQvZGF0YWJhc2VcIi4nLFxuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBjb25maWc7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnN0IGVycm9yID0gZXJyIGFzIEVycm9yO1xuICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yPEFtcGxpZnlHZW5lcmF0ZVNjaGVtYUVycm9yPihcbiAgICAgICdEYXRhYmFzZVVybFBhcnNlRXJyb3InLFxuICAgICAge1xuICAgICAgICBtZXNzYWdlOiBgVW5hYmxlIHRvIHBhcnNlIHRoZSBkYXRhYmFzZSBVUkwuICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICByZXNvbHV0aW9uOiAnQ2hlY2sgaWYgdGhlIGRhdGFiYXNlIFVSTCBpcyBjb3JyZWN0IGFuZCBhY2Nlc3NpYmxlLicsXG4gICAgICB9XG4gICAgKTtcbiAgfVxufTtcblxuY29uc3QgY29uc3RydWN0REJFbmdpbmUgPSAoZW5naW5lOiBzdHJpbmcpOiBTUUxFbmdpbmUgPT4ge1xuICBzd2l0Y2ggKGVuZ2luZSkge1xuICAgIGNhc2UgJ215c3FsJzpcbiAgICAgIHJldHVybiAnbXlzcWwnO1xuICAgIGNhc2UgJ3Bvc3RncmVzcWwnOlxuICAgIGNhc2UgJ3Bvc3RncmVzJzpcbiAgICAgIHJldHVybiAncG9zdGdyZXNxbCc7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgZGF0YWJhc2UgZW5naW5lOiAke2VuZ2luZX1gKTtcbiAgfVxufTtcblxuY29uc3QgZ2V0RGVmYXVsdFBvcnQgPSAoZW5naW5lOiBTUUxFbmdpbmUpOiBudW1iZXIgPT4ge1xuICBzd2l0Y2ggKGVuZ2luZSkge1xuICAgIGNhc2UgJ215c3FsJzpcbiAgICAgIHJldHVybiAzMzA2O1xuICAgIGNhc2UgJ3Bvc3RncmVzcWwnOlxuICAgICAgcmV0dXJuIDU0MzI7XG4gIH1cbn07XG4iXX0=