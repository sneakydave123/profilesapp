import { AmplifyError, AmplifyFault, AmplifyUserError, } from '@aws-amplify/platform-core';
import { EOL } from 'os';
/**
 * Transforms CDK error messages to human readable ones
 */
export class CdkErrorMapper {
    formatter;
    /**
     * Instantiate with a formatter that will be used for formatting CLI commands in error messages
     */
    constructor(formatter) {
        this.formatter = formatter;
    }
    getAmplifyError = (error) => {
        let underlyingError = error;
        // Check if there was an Amplify error thrown during child process execution
        const amplifyError = AmplifyError.fromStderr(error.message);
        if (amplifyError) {
            return amplifyError;
        }
        const matchingError = this.getKnownErrors().find((knownError) => knownError.errorRegex.test(error.message));
        if (matchingError) {
            // Extract meaningful contextual information if available
            const matchGroups = error.message.match(matchingError.errorRegex);
            if (matchGroups && matchGroups.length > 1) {
                // If the contextual information can be used in the error message use it, else consider it as a downstream cause
                if (matchGroups.groups) {
                    for (const [key, value] of Object.entries(matchGroups.groups)) {
                        const placeHolder = `{${key}}`;
                        if (matchingError.humanReadableErrorMessage.includes(placeHolder)) {
                            matchingError.humanReadableErrorMessage =
                                matchingError.humanReadableErrorMessage.replace(placeHolder, value);
                            // reset the stderr dump in the underlying error
                            underlyingError = undefined;
                        }
                    }
                }
                else {
                    underlyingError.message = matchGroups[0];
                }
            }
            return matchingError.classification === 'ERROR'
                ? new AmplifyUserError(matchingError.errorName, {
                    message: matchingError.humanReadableErrorMessage,
                    resolution: matchingError.resolutionMessage,
                }, underlyingError)
                : new AmplifyFault(matchingError.errorName, {
                    message: matchingError.humanReadableErrorMessage,
                    resolution: matchingError.resolutionMessage,
                }, underlyingError);
        }
        return AmplifyError.fromError(error);
    };
    getKnownErrors = () => [
        {
            errorRegex: /ExpiredToken/,
            humanReadableErrorMessage: 'The security token included in the request is invalid.',
            resolutionMessage: 'Ensure your local AWS credentials are valid.',
            errorName: 'ExpiredTokenError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Access Denied/,
            humanReadableErrorMessage: 'The deployment role does not have sufficient permissions to perform this deployment.',
            resolutionMessage: 'Ensure your deployment role has the AmplifyBackendDeployFullAccess role along with any additional permissions required to deploy your backend definition.',
            errorName: 'AccessDeniedError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Has the environment been bootstrapped/,
            humanReadableErrorMessage: 'This AWS account and region has not been bootstrapped.',
            resolutionMessage: 'Run `cdk bootstrap aws://{YOUR_ACCOUNT_ID}/{YOUR_REGION}` locally to resolve this.',
            errorName: 'BootstrapNotDetectedError',
            classification: 'ERROR',
        },
        {
            errorRegex: new RegExp(`(SyntaxError|ReferenceError|TypeError):((?:.|${EOL})*?at .*)`),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'SyntaxError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Unable to resolve AWS account to use/,
            humanReadableErrorMessage: 'Unable to resolve AWS account to use. It must be either configured when you define your CDK Stack, or through the environment',
            resolutionMessage: 'You can retry your last request as this is most likely a transient issue: https://github.com/aws/aws-cdk/issues/24744. If the error persists ensure your local AWS credentials are valid.',
            errorName: 'CDKResolveAWSAccountError',
            classification: 'ERROR',
        },
        {
            errorRegex: /EACCES(.*)/,
            humanReadableErrorMessage: 'File permissions error',
            resolutionMessage: 'Check that you have the right access permissions to the mentioned file',
            errorName: 'FilePermissionsError',
            classification: 'ERROR',
        },
        {
            errorRegex: new RegExp(`\\[ERR_MODULE_NOT_FOUND\\]:(.*)${EOL}|Error: Cannot find module (.*)`),
            humanReadableErrorMessage: 'Cannot find module',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for missing file or package imports. Try installing them with your package manager.',
            errorName: 'ModuleNotFoundError',
            classification: 'ERROR',
        },
        {
            // Truncate the cdk error message's second line (Invoke the CLI in sequence, or use '--output' to synth into different directories.)
            errorRegex: /Another CLI (.*) is currently(.*)\. |Other CLIs (.*) are currently reading from(.*)\. /,
            humanReadableErrorMessage: 'Multiple sandbox instances detected.',
            resolutionMessage: 'Make sure only one instance of sandbox is running for this project',
            errorName: 'MultipleSandboxInstancesError',
            classification: 'ERROR',
        },
        {
            // Also extracts the first line in the stack where the error happened
            errorRegex: new RegExp(`\\[esbuild Error\\]: ((?:.|${EOL})*?at .*)`),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'ESBuildError',
            classification: 'ERROR',
        },
        {
            errorRegex: new RegExp(`\\[TransformError\\]: Transform failed with .* error:${EOL}(?<esBuildErrorMessage>.*)`),
            humanReadableErrorMessage: '{esBuildErrorMessage}',
            resolutionMessage: 'Fix the above mentioned type or syntax error in your backend definition.',
            errorName: 'ESBuildError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Amplify Backend not found in/,
            humanReadableErrorMessage: 'Backend definition could not be found in amplify directory.',
            resolutionMessage: 'Ensure that the amplify/backend.(ts|js) file exists',
            errorName: 'FileConventionError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Amplify (.*) must be defined in (.*)/,
            humanReadableErrorMessage: 'File name or path for backend definition are incorrect.',
            resolutionMessage: 'Ensure that the amplify/backend.(ts|js) file exists',
            errorName: 'FileConventionError',
            classification: 'ERROR',
        },
        {
            errorRegex: /Updates are not allowed for property/,
            humanReadableErrorMessage: 'The changes that you are trying to apply are not supported.',
            resolutionMessage: 'The resources referenced in the error message must be deleted and recreated to apply the changes.',
            errorName: 'CFNUpdateNotSupportedError',
            classification: 'ERROR',
        },
        {
            // This error originates from Cognito service when user tries to change UserPool attributes which is not allowed
            // https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html
            // Remapping to `UpdateNotSupported` will allow sandbox to prompt users for resetting their environment
            errorRegex: /Invalid AttributeDataType input, consider using the provided AttributeDataType enum/,
            humanReadableErrorMessage: 'User pool attributes cannot be changed after a user pool has been created.',
            resolutionMessage: 'To change these attributes, remove `defineAuth` from your backend, deploy, then add it back. Note that removing `defineAuth` and deploying will delete any users stored in your UserPool.',
            errorName: 'CFNUpdateNotSupportedError',
            classification: 'ERROR',
        },
        {
            // Error: .* is printed to stderr during cdk synth
            // Also extracts the first line in the stack where the error happened
            errorRegex: new RegExp(`^Error: (.*${EOL}.*at.*)`, 'm'),
            humanReadableErrorMessage: 'Unable to build the Amplify backend definition.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'BackendSynthError',
            classification: 'ERROR',
        },
        {
            // "Catch all": the backend entry point file is referenced in the stack indicating a problem in customer code
            errorRegex: /amplify\/backend/,
            humanReadableErrorMessage: 'Unable to build Amplify backend.',
            resolutionMessage: 'Check your backend definition in the `amplify` folder for syntax and type errors.',
            errorName: 'BackendBuildError',
            classification: 'ERROR',
        },
        {
            // We capture the parameter name to show relevant error message
            errorRegex: /Failed to retrieve backend secret (?<secretName>.*) for.*ParameterNotFound/,
            humanReadableErrorMessage: `The secret {secretName} specified in the backend does not exist.`,
            resolutionMessage: `Create secrets using the command ${this.formatter.normalizeAmpxCommand('sandbox secret set')}. For more information, see https://docs.amplify.aws/gen2/deploy-and-host/sandbox-environments/features/#set-secrets`,
            errorName: 'SecretNotSetError',
            classification: 'ERROR',
        },
        {
            // Note that the order matters, this should be the last as it captures generic CFN error
            errorRegex: new RegExp(`❌ Deployment failed: (.*)${EOL}`),
            humanReadableErrorMessage: 'The CloudFormation deployment has failed.',
            resolutionMessage: 'Find more information in the CloudFormation AWS Console for this stack.',
            errorName: 'CloudFormationDeploymentError',
            classification: 'ERROR',
        },
    ];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrX2Vycm9yX21hcHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jZGtfZXJyb3JfbWFwcGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxZQUFZLEVBRVosWUFBWSxFQUNaLGdCQUFnQixHQUNqQixNQUFNLDRCQUE0QixDQUFDO0FBRXBDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFFekI7O0dBRUc7QUFDSCxNQUFNLE9BQU8sY0FBYztJQUlJO0lBSDdCOztPQUVHO0lBQ0gsWUFBNkIsU0FBeUM7UUFBekMsY0FBUyxHQUFULFNBQVMsQ0FBZ0M7SUFBRyxDQUFDO0lBRTFFLGVBQWUsR0FBRyxDQUNoQixLQUFZLEVBQytCLEVBQUU7UUFDN0MsSUFBSSxlQUFlLEdBQXNCLEtBQUssQ0FBQztRQUUvQyw0RUFBNEU7UUFDNUUsTUFBTSxZQUFZLEdBQUcsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDNUQsSUFBSSxZQUFZLEVBQUU7WUFDaEIsT0FBTyxZQUFZLENBQUM7U0FDckI7UUFFRCxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FDOUQsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUMxQyxDQUFDO1FBRUYsSUFBSSxhQUFhLEVBQUU7WUFDakIseURBQXlEO1lBQ3pELE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUVsRSxJQUFJLFdBQVcsSUFBSSxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDekMsZ0hBQWdIO2dCQUNoSCxJQUFJLFdBQVcsQ0FBQyxNQUFNLEVBQUU7b0JBQ3RCLEtBQUssTUFBTSxDQUFDLEdB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QTRFO1lBQzlFLGlCQUFpQixFQUNmLDJMQUEyTDtZQUM3TCxTQUFTLEVBQUUsNEJBQTRCO1lBQ3ZDLGNBQWMsRUFBRSxPQUFPO1NBQ3hCO1FBQ0Q7WUFDRSxrREFBa0Q7WUFDbEQscUVBQXFFO1lBQ3JFLFVBQVUsRUFBRSxJQUFJLE1BQU0sQ0FBQyxjQUFjLEdBQUcsU0FBUyxFQUFFLEdBQUcsQ0FBQztZQUN2RCx5QkFBeUIsRUFDdkIsaURBQWlEO1lBQ25ELGlCQUFpQixFQUNmLG1GQUFtRjtZQUNyRixTQUFTLEVBQUUsbUJBQW1CO1lBQzlCLGNBQWMsRUFBRSxPQUFPO1NBQ3hCO1FBQ0Q7WUFDRSw2R0FBNkc7WUFDN0csVUFBVSxFQUFFLGtCQUFrQjtZQUM5Qix5QkFBeUIsRUFBRSxrQ0FBa0M7WUFDN0QsaUJBQWlCLEVBQ2YsbUZBQW1GO1lBQ3JGLFNBQVMsRUFBRSxtQkFBbUI7WUFDOUIsY0FBYyxFQUFFLE9BQU87U0FDeEI7UUFDRDtZQUNFLCtEQUErRDtZQUMvRCxVQUFVLEVBQ1IsNEVBQTRFO1lBQzlFLHlCQUF5QixFQUFFLGtFQUFrRTtZQUM3RixpQkFBaUIsRUFBRSxvQ0FBb0MsSUFBSSxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsQ0FDeEYsb0JBQW9CLENBQ3JCLHNIQUFzSDtZQUN2SCxTQUFTLEVBQUUsbUJBQW1CO1lBQzlCLGNBQWMsRUFBRSxPQUFPO1NBQ3hCO1FBQ0Q7WUFDRSx3RkFBd0Y7WUFDeEYsVUFBVSxFQUFFLElBQUksTUFBTSxDQUFDLDRCQUE0QixHQUFHLEVBQUUsQ0FBQztZQUN6RCx5QkFBeUIsRUFBRSwyQ0FBMkM7WUFDdEUsaUJBQWlCLEVBQ2YseUVBQXlFO1lBQzNFLFNBQVMsRUFBRSwrQkFBK0I7WUFDMUMsY0FBYyxFQUFFLE9BQU87U0FDeEI7S0FDRixDQUFDO0NBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBbXBsaWZ5RXJyb3IsXG4gIEFtcGxpZnlFcnJvckNsYXNzaWZpY2F0aW9uLFxuICBBbXBsaWZ5RmF1bHQsXG4gIEFtcGxpZnlVc2VyRXJyb3IsXG59IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbGF0Zm9ybS1jb3JlJztcbmltcG9ydCB7IEJhY2tlbmREZXBsb3llck91dHB1dEZvcm1hdHRlciB9IGZyb20gJy4vdHlwZXMuanMnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuXG4vKipcbiAqIFRyYW5zZm9ybXMgQ0RLIGVycm9yIG1lc3NhZ2VzIHRvIGh1bWFuIHJlYWRhYmxlIG9uZXNcbiAqL1xuZXhwb3J0IGNsYXNzIENka0Vycm9yTWFwcGVyIHtcbiAgLyoqXG4gICAqIEluc3RhbnRpYXRlIHdpdGggYSBmb3JtYXR0ZXIgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIGZvcm1hdHRpbmcgQ0xJIGNvbW1hbmRzIGluIGVycm9yIG1lc3NhZ2VzXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGZvcm1hdHRlcjogQmFja2VuZERlcGxveWVyT3V0cHV0Rm9ybWF0dGVyKSB7fVxuXG4gIGdldEFtcGxpZnlFcnJvciA9IChcbiAgICBlcnJvcjogRXJyb3JcbiAgKTogQW1wbGlmeUVycm9yPENES0RlcGxveW1lbnRFcnJvciB8IHN0cmluZz4gPT4ge1xuICAgIGxldCB1bmRlcmx5aW5nRXJyb3I6IEVycm9yIHwgdW5kZWZpbmVkID0gZXJyb3I7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyZSB3YXMgYW4gQW1wbGlmeSBlcnJvciB0aHJvd24gZHVyaW5nIGNoaWxkIHByb2Nlc3MgZXhlY3V0aW9uXG4gICAgY29uc3QgYW1wbGlmeUVycm9yID0gQW1wbGlmeUVycm9yLmZyb21TdGRlcnIoZXJyb3IubWVzc2FnZSk7XG4gICAgaWYgKGFtcGxpZnlFcnJvcikge1xuICAgICAgcmV0dXJuIGFtcGxpZnlFcnJvcjtcbiAgICB9XG5cbiAgICBjb25zdCBtYXRjaGluZ0Vycm9yID0gdGhpcy5nZXRLbm93bkVycm9ycygpLmZpbmQoKGtub3duRXJyb3IpID0+XG4gICAgICBrbm93bkVycm9yLmVycm9yUmVnZXgudGVzdChlcnJvci5tZXNzYWdlKVxuICAgICk7XG5cbiAgICBpZiAobWF0Y2hpbmdFcnJvcikge1xuICAgICAgLy8gRXh0cmFjdCBtZWFuaW5nZnVsIGNvbnRleHR1YWwgaW5mb3JtYXRpb24gaWYgYXZhaWxhYmxlXG4gICAgICBjb25zdCBtYXRjaEdyb3VwcyA9IGVycm9yLm1lc3NhZ2UubWF0Y2gobWF0Y2hpbmdFcnJvci5lcnJvclJlZ2V4KTtcblxuICAgICAgaWYgKG1hdGNoR3JvdXBzICYmIG1hdGNoR3JvdXBzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgLy8gSWYgdGhlIGNvbnRleHR1YWwgaW5mb3JtYXRpb24gY2FuIGJlIHVzZWQgaW4gdGhlIGVycm9yIG1lc3NhZ2UgdXNlIGl0LCBlbHNlIGNvbnNpZGVyIGl0IGFzIGEgZG93bnN0cmVhbSBjYXVzZVxuICAgICAgICBpZiAobWF0Y2hHcm91cHMuZ3JvdXBzKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMobWF0Y2hHcm91cHMuZ3JvdXBzKSkge1xuICAgICAgICAgICAgY29uc3QgcGxhY2VIb2xkZXIgPSBgeyR7a2V5fX1gO1xuICAgICAgICAgICAgaWYgKG1hdGNoaW5nRXJyb3IuaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZS5pbmNsdWRlcyhwbGFjZUhvbGRlcikpIHtcbiAgICAgICAgICAgICAgbWF0Y2hpbmdFcnJvci5odW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlID1cbiAgICAgICAgICAgICAgICBtYXRjaGluZ0Vycm9yLmh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2UucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgIHBsYWNlSG9sZGVyLFxuICAgICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAvLyByZXNldCB0aGUgc3RkZXJyIGR1bXAgaW4gdGhlIHVuZGVybHlpbmcgZXJyb3JcbiAgICAgICAgICAgICAgdW5kZXJseWluZ0Vycm9yID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB1bmRlcmx5aW5nRXJyb3IubWVzc2FnZSA9IG1hdGNoR3JvdXBzWzBdO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBtYXRjaGluZ0Vycm9yLmNsYXNzaWZpY2F0aW9uID09PSAnRVJST1InXG4gICAgICAgID8gbmV3IEFtcGxpZnlVc2VyRXJyb3IoXG4gICAgICAgICAgICBtYXRjaGluZ0Vycm9yLmVycm9yTmFtZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogbWF0Y2hpbmdFcnJvci5odW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlLFxuICAgICAgICAgICAgICByZXNvbHV0aW9uOiBtYXRjaGluZ0Vycm9yLnJlc29sdXRpb25NZXNzYWdlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVuZGVybHlpbmdFcnJvclxuICAgICAgICAgIClcbiAgICAgICAgOiBuZXcgQW1wbGlmeUZhdWx0KFxuICAgICAgICAgICAgbWF0Y2hpbmdFcnJvci5lcnJvck5hbWUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IG1hdGNoaW5nRXJyb3IuaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZSxcbiAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbWF0Y2hpbmdFcnJvci5yZXNvbHV0aW9uTWVzc2FnZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1bmRlcmx5aW5nRXJyb3JcbiAgICAgICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gQW1wbGlmeUVycm9yLmZyb21FcnJvcihlcnJvcik7XG4gIH07XG5cbiAgcHJpdmF0ZSBnZXRLbm93bkVycm9ycyA9ICgpOiBBcnJheTx7XG4gICAgZXJyb3JSZWdleDogUmVnRXhwO1xuICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6IHN0cmluZztcbiAgICByZXNvbHV0aW9uTWVzc2FnZTogc3RyaW5nO1xuICAgIGVycm9yTmFtZTogQ0RLRGVwbG95bWVudEVycm9yO1xuICAgIGNsYXNzaWZpY2F0aW9uOiBBbXBsaWZ5RXJyb3JDbGFzc2lmaWNhdGlvbjtcbiAgfT4gPT4gW1xuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9FeHBpcmVkVG9rZW4vLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1RoZSBzZWN1cml0eSB0b2tlbiBpbmNsdWRlZCBpbiB0aGUgcmVxdWVzdCBpcyBpbnZhbGlkLicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTogJ0Vuc3VyZSB5b3VyIGxvY2FsIEFXUyBjcmVkZW50aWFscyBhcmUgdmFsaWQuJyxcbiAgICAgIGVycm9yTmFtZTogJ0V4cGlyZWRUb2tlbkVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgZXJyb3JSZWdleDogL0FjY2VzcyBEZW5pZWQvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1RoZSBkZXBsb3ltZW50IHJvbGUgZG9lcyBub3QgaGF2ZSBzdWZmaWNpZW50IHBlcm1pc3Npb25zIHRvIHBlcmZvcm0gdGhpcyBkZXBsb3ltZW50LicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0Vuc3VyZSB5b3VyIGRlcGxveW1lbnQgcm9sZSBoYXMgdGhlIEFtcGxpZnlCYWNrZW5kRGVwbG95RnVsbEFjY2VzcyByb2xlIGFsb25nIHdpdGggYW55IGFkZGl0aW9uYWwgcGVybWlzc2lvbnMgcmVxdWlyZWQgdG8gZGVwbG95IHlvdXIgYmFja2VuZCBkZWZpbml0aW9uLicsXG4gICAgICBlcnJvck5hbWU6ICdBY2Nlc3NEZW5pZWRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9IYXMgdGhlIGVudmlyb25tZW50IGJlZW4gYm9vdHN0cmFwcGVkLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdUaGlzIEFXUyBhY2NvdW50IGFuZCByZWdpb24gaGFzIG5vdCBiZWVuIGJvb3RzdHJhcHBlZC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdSdW4gYGNkayBib290c3RyYXAgYXdzOi8ve1lPVVJfQUNDT1VOVF9JRH0ve1lPVVJfUkVHSU9OfWAgbG9jYWxseSB0byByZXNvbHZlIHRoaXMuJyxcbiAgICAgIGVycm9yTmFtZTogJ0Jvb3RzdHJhcE5vdERldGVjdGVkRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICBlcnJvclJlZ2V4OiBuZXcgUmVnRXhwKFxuICAgICAgICBgKFN5bnRheEVycm9yfFJlZmVyZW5jZUVycm9yfFR5cGVFcnJvcik6KCg/Oi58JHtFT0x9KSo/YXQgLiopYFxuICAgICAgKSxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdVbmFibGUgdG8gYnVpbGQgdGhlIEFtcGxpZnkgYmFja2VuZCBkZWZpbml0aW9uLicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0NoZWNrIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uIGluIHRoZSBgYW1wbGlmeWAgZm9sZGVyIGZvciBzeW50YXggYW5kIHR5cGUgZXJyb3JzLicsXG4gICAgICBlcnJvck5hbWU6ICdTeW50YXhFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9VbmFibGUgdG8gcmVzb2x2ZSBBV1MgYWNjb3VudCB0byB1c2UvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1VuYWJsZSB0byByZXNvbHZlIEFXUyBhY2NvdW50IHRvIHVzZS4gSXQgbXVzdCBiZSBlaXRoZXIgY29uZmlndXJlZCB3aGVuIHlvdSBkZWZpbmUgeW91ciBDREsgU3RhY2ssIG9yIHRocm91Z2ggdGhlIGVudmlyb25tZW50JyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnWW91IGNhbiByZXRyeSB5b3VyIGxhc3QgcmVxdWVzdCBhcyB0aGlzIGlzIG1vc3QgbGlrZWx5IGEgdHJhbnNpZW50IGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vYXdzL2F3cy1jZGsvaXNzdWVzLzI0NzQ0LiBJZiB0aGUgZXJyb3IgcGVyc2lzdHMgZW5zdXJlIHlvdXIgbG9jYWwgQVdTIGNyZWRlbnRpYWxzIGFyZSB2YWxpZC4nLFxuICAgICAgZXJyb3JOYW1lOiAnQ0RLUmVzb2x2ZUFXU0FjY291bnRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9FQUNDRVMoLiopLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6ICdGaWxlIHBlcm1pc3Npb25zIGVycm9yJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnQ2hlY2sgdGhhdCB5b3UgaGF2ZSB0aGUgcmlnaHQgYWNjZXNzIHBlcm1pc3Npb25zIHRvIHRoZSBtZW50aW9uZWQgZmlsZScsXG4gICAgICBlcnJvck5hbWU6ICdGaWxlUGVybWlzc2lvbnNFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoXG4gICAgICAgIGBcXFxcW0VSUl9NT0RVTEVfTk9UX0ZPVU5EXFxcXF06KC4qKSR7RU9MfXxFcnJvcjogQ2Fubm90IGZpbmQgbW9kdWxlICguKilgXG4gICAgICApLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogJ0Nhbm5vdCBmaW5kIG1vZHVsZScsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0NoZWNrIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uIGluIHRoZSBgYW1wbGlmeWAgZm9sZGVyIGZvciBtaXNzaW5nIGZpbGUgb3IgcGFja2FnZSBpbXBvcnRzLiBUcnkgaW5zdGFsbGluZyB0aGVtIHdpdGggeW91ciBwYWNrYWdlIG1hbmFnZXIuJyxcbiAgICAgIGVycm9yTmFtZTogJ01vZHVsZU5vdEZvdW5kRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICAvLyBUcnVuY2F0ZSB0aGUgY2RrIGVycm9yIG1lc3NhZ2UncyBzZWNvbmQgbGluZSAoSW52b2tlIHRoZSBDTEkgaW4gc2VxdWVuY2UsIG9yIHVzZSAnLS1vdXRwdXQnIHRvIHN5bnRoIGludG8gZGlmZmVyZW50IGRpcmVjdG9yaWVzLilcbiAgICAgIGVycm9yUmVnZXg6XG4gICAgICAgIC9Bbm90aGVyIENMSSAoLiopIGlzIGN1cnJlbnRseSguKilcXC4gfE90aGVyIENMSXMgKC4qKSBhcmUgY3VycmVudGx5IHJlYWRpbmcgZnJvbSguKilcXC4gLyxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6ICdNdWx0aXBsZSBzYW5kYm94IGluc3RhbmNlcyBkZXRlY3RlZC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6XG4gICAgICAgICdNYWtlIHN1cmUgb25seSBvbmUgaW5zdGFuY2Ugb2Ygc2FuZGJveCBpcyBydW5uaW5nIGZvciB0aGlzIHByb2plY3QnLFxuICAgICAgZXJyb3JOYW1lOiAnTXVsdGlwbGVTYW5kYm94SW5zdGFuY2VzRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICAvLyBBbHNvIGV4dHJhY3RzIHRoZSBmaXJzdCBsaW5lIGluIHRoZSBzdGFjayB3aGVyZSB0aGUgZXJyb3IgaGFwcGVuZWRcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoYFxcXFxbZXNidWlsZCBFcnJvclxcXFxdOiAoKD86Lnwke0VPTH0pKj9hdCAuKilgKSxcbiAgICAgIGh1bWFuUmVhZGFibGVFcnJvck1lc3NhZ2U6XG4gICAgICAgICdVbmFibGUgdG8gYnVpbGQgdGhlIEFtcGxpZnkgYmFja2VuZCBkZWZpbml0aW9uLicsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0NoZWNrIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uIGluIHRoZSBgYW1wbGlmeWAgZm9sZGVyIGZvciBzeW50YXggYW5kIHR5cGUgZXJyb3JzLicsXG4gICAgICBlcnJvck5hbWU6ICdFU0J1aWxkRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICBlcnJvclJlZ2V4OiBuZXcgUmVnRXhwKFxuICAgICAgICBgXFxcXFtUcmFuc2Zvcm1FcnJvclxcXFxdOiBUcmFuc2Zvcm0gZmFpbGVkIHdpdGggLiogZXJyb3I6JHtFT0x9KD88ZXNCdWlsZEVycm9yTWVzc2FnZT4uKilgXG4gICAgICApLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogJ3tlc0J1aWxkRXJyb3JNZXNzYWdlfScsXG4gICAgICByZXNvbHV0aW9uTWVzc2FnZTpcbiAgICAgICAgJ0ZpeCB0aGUgYWJvdmUgbWVudGlvbmVkIHR5cGUgb3Igc3ludGF4IGVycm9yIGluIHlvdXIgYmFja2VuZCBkZWZpbml0aW9uLicsXG4gICAgICBlcnJvck5hbWU6ICdFU0J1aWxkRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICBlcnJvclJlZ2V4OiAvQW1wbGlmeSBCYWNrZW5kIG5vdCBmb3VuZCBpbi8sXG4gICAgICBodW1hblJlYWRhYmxlRXJyb3JNZXNzYWdlOlxuICAgICAgICAnQmFja2VuZCBkZWZpbml0aW9uIGNvdWxkIG5vdCBiZSBmb3VuZCBpbiBhbXBsaWZ5IGRpcmVjdG9yeS4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6ICdFbnN1cmUgdGhhdCB0aGUgYW1wbGlmeS9iYWNrZW5kLih0c3xqcykgZmlsZSBleGlzdHMnLFxuICAgICAgZXJyb3JOYW1lOiAnRmlsZUNvbnZlbnRpb25FcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9BbXBsaWZ5ICguKikgbXVzdCBiZSBkZWZpbmVkIGluICguKikvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ0ZpbGUgbmFtZSBvciBwYXRoIGZvciBiYWNrZW5kIGRlZmluaXRpb24gYXJlIGluY29ycmVjdC4nLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6ICdFbnN1cmUgdGhhdCB0aGUgYW1wbGlmeS9iYWNrZW5kLih0c3xqcykgZmlsZSBleGlzdHMnLFxuICAgICAgZXJyb3JOYW1lOiAnRmlsZUNvbnZlbnRpb25FcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGVycm9yUmVnZXg6IC9VcGRhdGVzIGFyZSBub3QgYWxsb3dlZCBmb3IgcHJvcGVydHkvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1RoZSBjaGFuZ2VzIHRoYXQgeW91IGFyZSB0cnlpbmcgdG8gYXBwbHkgYXJlIG5vdCBzdXBwb3J0ZWQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnVGhlIHJlc291cmNlcyByZWZlcmVuY2VkIGluIHRoZSBlcnJvciBtZXNzYWdlIG11c3QgYmUgZGVsZXRlZCBhbmQgcmVjcmVhdGVkIHRvIGFwcGx5IHRoZSBjaGFuZ2VzLicsXG4gICAgICBlcnJvck5hbWU6ICdDRk5VcGRhdGVOb3RTdXBwb3J0ZWRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIC8vIFRoaXMgZXJyb3Igb3JpZ2luYXRlcyBmcm9tIENvZ25pdG8gc2VydmljZSB3aGVuIHVzZXIgdHJpZXMgdG8gY2hhbmdlIFVzZXJQb29sIGF0dHJpYnV0ZXMgd2hpY2ggaXMgbm90IGFsbG93ZWRcbiAgICAgIC8vIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2duaXRvL2xhdGVzdC9kZXZlbG9wZXJndWlkZS91c2VyLXBvb2wtc2V0dGluZ3MtYXR0cmlidXRlcy5odG1sXG4gICAgICAvLyBSZW1hcHBpbmcgdG8gYFVwZGF0ZU5vdFN1cHBvcnRlZGAgd2lsbCBhbGxvdyBzYW5kYm94IHRvIHByb21wdCB1c2VycyBmb3IgcmVzZXR0aW5nIHRoZWlyIGVudmlyb25tZW50XG4gICAgICBlcnJvclJlZ2V4OlxuICAgICAgICAvSW52YWxpZCBBdHRyaWJ1dGVEYXRhVHlwZSBpbnB1dCwgY29uc2lkZXIgdXNpbmcgdGhlIHByb3ZpZGVkIEF0dHJpYnV0ZURhdGFUeXBlIGVudW0vLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1VzZXIgcG9vbCBhdHRyaWJ1dGVzIGNhbm5vdCBiZSBjaGFuZ2VkIGFmdGVyIGEgdXNlciBwb29sIGhhcyBiZWVuIGNyZWF0ZWQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnVG8gY2hhbmdlIHRoZXNlIGF0dHJpYnV0ZXMsIHJlbW92ZSBgZGVmaW5lQXV0aGAgZnJvbSB5b3VyIGJhY2tlbmQsIGRlcGxveSwgdGhlbiBhZGQgaXQgYmFjay4gTm90ZSB0aGF0IHJlbW92aW5nIGBkZWZpbmVBdXRoYCBhbmQgZGVwbG95aW5nIHdpbGwgZGVsZXRlIGFueSB1c2VycyBzdG9yZWQgaW4geW91ciBVc2VyUG9vbC4nLFxuICAgICAgZXJyb3JOYW1lOiAnQ0ZOVXBkYXRlTm90U3VwcG9ydGVkRXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgICB7XG4gICAgICAvLyBFcnJvcjogLiogaXMgcHJpbnRlZCB0byBzdGRlcnIgZHVyaW5nIGNkayBzeW50aFxuICAgICAgLy8gQWxzbyBleHRyYWN0cyB0aGUgZmlyc3QgbGluZSBpbiB0aGUgc3RhY2sgd2hlcmUgdGhlIGVycm9yIGhhcHBlbmVkXG4gICAgICBlcnJvclJlZ2V4OiBuZXcgUmVnRXhwKGBeRXJyb3I6ICguKiR7RU9MfS4qYXQuKilgLCAnbScpLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTpcbiAgICAgICAgJ1VuYWJsZSB0byBidWlsZCB0aGUgQW1wbGlmeSBiYWNrZW5kIGRlZmluaXRpb24uJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnQ2hlY2sgeW91ciBiYWNrZW5kIGRlZmluaXRpb24gaW4gdGhlIGBhbXBsaWZ5YCBmb2xkZXIgZm9yIHN5bnRheCBhbmQgdHlwZSBlcnJvcnMuJyxcbiAgICAgIGVycm9yTmFtZTogJ0JhY2tlbmRTeW50aEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gXCJDYXRjaCBhbGxcIjogdGhlIGJhY2tlbmQgZW50cnkgcG9pbnQgZmlsZSBpcyByZWZlcmVuY2VkIGluIHRoZSBzdGFjayBpbmRpY2F0aW5nIGEgcHJvYmxlbSBpbiBjdXN0b21lciBjb2RlXG4gICAgICBlcnJvclJlZ2V4OiAvYW1wbGlmeVxcL2JhY2tlbmQvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogJ1VuYWJsZSB0byBidWlsZCBBbXBsaWZ5IGJhY2tlbmQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnQ2hlY2sgeW91ciBiYWNrZW5kIGRlZmluaXRpb24gaW4gdGhlIGBhbXBsaWZ5YCBmb2xkZXIgZm9yIHN5bnRheCBhbmQgdHlwZSBlcnJvcnMuJyxcbiAgICAgIGVycm9yTmFtZTogJ0JhY2tlbmRCdWlsZEVycm9yJyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiAnRVJST1InLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gV2UgY2FwdHVyZSB0aGUgcGFyYW1ldGVyIG5hbWUgdG8gc2hvdyByZWxldmFudCBlcnJvciBtZXNzYWdlXG4gICAgICBlcnJvclJlZ2V4OlxuICAgICAgICAvRmFpbGVkIHRvIHJldHJpZXZlIGJhY2tlbmQgc2VjcmV0ICg/PHNlY3JldE5hbWU+LiopIGZvci4qUGFyYW1ldGVyTm90Rm91bmQvLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogYFRoZSBzZWNyZXQge3NlY3JldE5hbWV9IHNwZWNpZmllZCBpbiB0aGUgYmFja2VuZCBkb2VzIG5vdCBleGlzdC5gLFxuICAgICAgcmVzb2x1dGlvbk1lc3NhZ2U6IGBDcmVhdGUgc2VjcmV0cyB1c2luZyB0aGUgY29tbWFuZCAke3RoaXMuZm9ybWF0dGVyLm5vcm1hbGl6ZUFtcHhDb21tYW5kKFxuICAgICAgICAnc2FuZGJveCBzZWNyZXQgc2V0J1xuICAgICAgKX0uIEZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUgaHR0cHM6Ly9kb2NzLmFtcGxpZnkuYXdzL2dlbjIvZGVwbG95LWFuZC1ob3N0L3NhbmRib3gtZW52aXJvbm1lbnRzL2ZlYXR1cmVzLyNzZXQtc2VjcmV0c2AsXG4gICAgICBlcnJvck5hbWU6ICdTZWNyZXROb3RTZXRFcnJvcicsXG4gICAgICBjbGFzc2lmaWNhdGlvbjogJ0VSUk9SJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIC8vIE5vdGUgdGhhdCB0aGUgb3JkZXIgbWF0dGVycywgdGhpcyBzaG91bGQgYmUgdGhlIGxhc3QgYXMgaXQgY2FwdHVyZXMgZ2VuZXJpYyBDRk4gZXJyb3JcbiAgICAgIGVycm9yUmVnZXg6IG5ldyBSZWdFeHAoYOKdjCBEZXBsb3ltZW50IGZhaWxlZDogKC4qKSR7RU9MfWApLFxuICAgICAgaHVtYW5SZWFkYWJsZUVycm9yTWVzc2FnZTogJ1RoZSBDbG91ZEZvcm1hdGlvbiBkZXBsb3ltZW50IGhhcyBmYWlsZWQuJyxcbiAgICAgIHJlc29sdXRpb25NZXNzYWdlOlxuICAgICAgICAnRmluZCBtb3JlIGluZm9ybWF0aW9uIGluIHRoZSBDbG91ZEZvcm1hdGlvbiBBV1MgQ29uc29sZSBmb3IgdGhpcyBzdGFjay4nLFxuICAgICAgZXJyb3JOYW1lOiAnQ2xvdWRGb3JtYXRpb25EZXBsb3ltZW50RXJyb3InLFxuICAgICAgY2xhc3NpZmljYXRpb246ICdFUlJPUicsXG4gICAgfSxcbiAgXTtcbn1cblxuZXhwb3J0IHR5cGUgQ0RLRGVwbG95bWVudEVycm9yID1cbiAgfCAnQWNjZXNzRGVuaWVkRXJyb3InXG4gIHwgJ0JhY2tlbmRCdWlsZEVycm9yJ1xuICB8ICdCYWNrZW5kU3ludGhFcnJvcidcbiAgfCAnQm9vdHN0cmFwTm90RGV0ZWN0ZWRFcnJvcidcbiAgfCAnQ0RLUmVzb2x2ZUFXU0FjY291bnRFcnJvcidcbiAgfCAnQ0ZOVXBkYXRlTm90U3VwcG9ydGVkRXJyb3InXG4gIHwgJ0Nsb3VkRm9ybWF0aW9uRGVwbG95bWVudEVycm9yJ1xuICB8ICdGaWxlUGVybWlzc2lvbnNFcnJvcidcbiAgfCAnTXVsdGlwbGVTYW5kYm94SW5zdGFuY2VzRXJyb3InXG4gIHwgJ0VTQnVpbGRFcnJvcidcbiAgfCAnRXhwaXJlZFRva2VuRXJyb3InXG4gIHwgJ0ZpbGVDb252ZW50aW9uRXJyb3InXG4gIHwgJ0ZpbGVDb252ZW50aW9uRXJyb3InXG4gIHwgJ01vZHVsZU5vdEZvdW5kRXJyb3InXG4gIHwgJ1NlY3JldE5vdFNldEVycm9yJ1xuICB8ICdTeW50YXhFcnJvcic7XG4iXX0=